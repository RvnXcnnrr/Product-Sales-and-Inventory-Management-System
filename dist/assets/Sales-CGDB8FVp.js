import{d as se,r as t,e as ae,j as e,L as q,f as r,S as A,M as te,C as D,s as F,V as u}from"./index-DhFL0F8I.js";import{S as re,P as R}from"./search-jvWA0UuF.js";import{T as I}from"./trash-2-DelcfTuy.js";import{M as le}from"./minus-DrX-qSrg.js";import{D as ne}from"./dollar-sign-g218hD2t.js";import{C as ce}from"./credit-card-DscAFbWo.js";/**
 * @license lucide-react v0.307.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=se("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),pe=()=>{const[d,L]=t.useState(""),[p,E]=t.useState("all"),[O,m]=t.useState(!1),[n,f]=t.useState("cash"),[l,v]=t.useState(""),[j,C]=t.useState(!1),[z,g]=t.useState(!1),[y,x]=t.useState(null),{cart:c,totals:a,addItem:K,updateItem:U,removeItem:V,clearCart:w}=ae(),[Y,S]=t.useState(!0),[k,M]=t.useState(null),[$,B]=t.useState([]),[G,H]=t.useState([]),[J,Q]=t.useState(new Map);t.useEffect(()=>{let s=!0;return(async()=>{try{S(!0),M(null);const{data:i,error:N}=await F.from("products").select("id, name, sku, barcode, selling_price, stock_quantity, image_url, category_id").order("name",{ascending:!0});if(N)throw N;const{data:Z,error:_}=await F.from("categories").select("id, name").order("name",{ascending:!0});if(_)throw _;if(!s)return;B(i||[]);const P=new Map((Z||[]).map(h=>[h.id,h.name]));Q(P);const ee=Array.from(new Set((i||[]).map(h=>P.get(h.category_id)).filter(Boolean)));H(["all",...ee])}catch(i){if(!s)return;console.error("Failed to load products/categories:",i),M("Failed to load products")}finally{s&&S(!1)}})(),()=>{s=!1}},[]);const b=$.filter(s=>{const o=s.name.toLowerCase().includes(d.toLowerCase())||s.sku.toLowerCase().includes(d.toLowerCase())||(s.barcode||"").includes(d),i=J.get(s.category_id);return o&&(p==="all"||i===p)&&s.stock_quantity>0}),T=(s,o)=>{o<=0?x(s):U(s,{quantity:o})},W=async()=>{if(c.items.length===0){u.error("Cart is empty");return}if(n==="cash"){const s=parseFloat(l);if(!s||s<a.total){u.error("Insufficient amount received");return}}C(!0);try{await new Promise(s=>setTimeout(s,2e3)),console.log("Processing transaction:",{items:c.items,totals:a,paymentMethod:n,amountReceived:n==="cash"?parseFloat(l):a.total}),u.success("Transaction completed successfully!"),w(),m(!1),v(""),f("cash")}catch{u.error("Transaction failed. Please try again.")}finally{C(!1)}},X=n==="cash"&&l?Math.max(0,parseFloat(l)-a.total):0;return e.jsxs("div",{className:"h-full flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Point of Sale"}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs("span",{className:"text-sm text-gray-500",children:[b.length," products available"]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search products by name, SKU, or barcode...",value:d,onChange:s=>L(s.target.value),className:"input pl-10"})]}),e.jsx("select",{value:p,onChange:s=>E(s.target.value),className:"input w-full sm:w-auto",children:G.map(s=>e.jsx("option",{value:s,children:s==="all"?"All Categories":s},s))})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Y?e.jsx("div",{className:"col-span-full py-12",children:e.jsx(q,{})}):k?e.jsx("div",{className:"col-span-full text-center text-red-600 py-6",children:k}):b.map(s=>e.jsxs("div",{className:"card p-4 hover:shadow-md transition-shadow cursor-pointer",children:[e.jsx("div",{className:"aspect-square bg-gray-100 rounded-lg mb-3 flex items-center justify-center",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover rounded-lg"}):e.jsx("div",{className:"text-gray-400 text-4xl",children:"ðŸ“¦"})}),e.jsx("h3",{className:"font-medium text-gray-900 mb-1 line-clamp-2",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["SKU: ",s.sku]}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-lg font-bold text-primary-600",children:r(s.selling_price)}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.stock_quantity," in stock"]})]}),e.jsxs("button",{onClick:()=>K(s,1),className:"btn btn-primary btn-sm w-full",disabled:s.stock_quantity===0,children:[e.jsx(R,{className:"w-4 h-4 mr-1"}),"Add to Cart"]})]},s.id))}),b.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-6xl mb-4",children:"ðŸ”"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or filters"})]})]}),e.jsx("div",{className:"lg:w-80 xl:w-96",children:e.jsxs("div",{className:"card h-full flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Cart (",a.itemCount,")"]}),c.items.length>0&&e.jsx("button",{onClick:()=>g(!0),className:"text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(I,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c.items.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Your cart is empty"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Add products to get started"})]}):e.jsx("div",{className:"space-y-3",children:c.items.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-xl",children:"ðŸ“¦"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r(s.price)," each"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>T(s.product_id,s.quantity-1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 transition-colors",children:e.jsx(le,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-8 text-center font-medium",children:s.quantity}),e.jsx("button",{onClick:()=>T(s.product_id,s.quantity+1),className:"w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 transition-colors",children:e.jsx(R,{className:"w-3 h-3"})})]}),e.jsx("button",{onClick:()=>x(s.product_id),className:"text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(I,{className:"w-4 h-4"})})]},s.product_id))})}),c.items.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t border-gray-200 p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:r(a.subtotal)})]}),a.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsxs("span",{children:["Discount (",a.discount,"%):"]}),e.jsxs("span",{children:["-",r(a.discountAmount)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:["Tax (",a.taxRate,"%):"]}),e.jsx("span",{children:r(a.taxAmount)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:r(a.total)})]})]}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("button",{onClick:()=>m(!0),className:"btn btn-primary btn-lg w-full",children:[e.jsx(ie,{className:"w-5 h-5 mr-2"}),"Checkout"]})})]})]})}),e.jsx(te,{isOpen:O,onClose:()=>m(!1),title:"Complete Transaction",size:"md",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Order Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{children:r(a.subtotal)})]}),a.discount>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount:"}),e.jsxs("span",{children:["-",r(a.discountAmount)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax:"}),e.jsx("span",{children:r(a.taxAmount)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:r(a.total)})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Payment Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>f("cash"),className:`p-3 rounded-lg border-2 flex items-center justify-center space-x-2 transition-colors ${n==="cash"?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{children:"Cash"})]}),e.jsxs("button",{onClick:()=>f("card"),className:`p-3 rounded-lg border-2 flex items-center justify-center space-x-2 transition-colors ${n==="card"?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:"Card"})]})]})]}),n==="cash"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Amount Received"}),e.jsx("input",{type:"number",step:"0.01",value:l,onChange:s=>v(s.target.value),className:"input",placeholder:"0.00",autoFocus:!0})]}),l&&parseFloat(l)>=a.total&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-green-800",children:"Change Due:"}),e.jsx("span",{className:"text-xl font-bold text-green-800",children:r(X)})]})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"btn btn-secondary btn-md flex-1",disabled:j,children:"Cancel"}),e.jsx("button",{onClick:W,disabled:j||n==="cash"&&(!l||parseFloat(l)<a.total),className:"btn btn-primary btn-md flex-1",children:j?e.jsxs(e.Fragment,{children:[e.jsx(q,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Processing..."})]}):"Complete Sale"})]})]})}),e.jsx(D,{isOpen:z,onCancel:()=>g(!1),onConfirm:()=>{w(),g(!1)},title:"Clear cart?",description:"This will remove all items from the cart. You can't undo this action.",confirmText:"Clear",variant:"danger"}),e.jsx(D,{isOpen:y!=null,onCancel:()=>x(null),onConfirm:()=>{y!=null&&V(y),x(null)},title:"Remove item?",description:"This item will be removed from the cart.",confirmText:"Remove",variant:"danger"})]})};export{pe as default};
//# sourceMappingURL=Sales-CGDB8FVp.js.map
