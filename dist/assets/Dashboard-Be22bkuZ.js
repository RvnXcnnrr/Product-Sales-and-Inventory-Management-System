import{r as a,u as O,P as m,S as x,A as u,j as e,L as R,a as r,E as _,s as d}from"./index-B6zJEr8W.js";import{o as U}from"./eventBus-DPsVa6OD.js";import{D as q}from"./dollar-sign-gWT7RPE0.js";import{T as V}from"./trending-up-CgtHgPGZ.js";const B=()=>{const[T,h]=a.useState(!0),[j,g]=a.useState(null),[A,D]=a.useState([]),[E,P]=a.useState([]),[l,L]=a.useState({todaySales:0,transactionsToday:0,totalProducts:0,lowStockCount:0}),{settings:c}=O(),y=a.useMemo(()=>{try{return new Intl.NumberFormat(void 0,{style:"currency",currency:(c==null?void 0:c.currency)||"USD",maximumFractionDigits:2})}catch{return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:2})}},[c==null?void 0:c.currency]),N=a.useMemo(()=>{const s=new Date;return s.setHours(0,0,0,0),s.toISOString()},[]);a.useEffect(()=>{let s=!0;const n=async()=>{h(!0),g(null);try{const{data:i,error:f}=await d.from("transactions").select("id, customer_name, total_amount, processed_at, status, transaction_items(count)").order("processed_at",{ascending:!1}).limit(5);if(f)throw f;const{data:b,error:v}=await d.from("transactions").select("id, total_amount, processed_at").gte("processed_at",N);if(v)throw v;const{count:F,error:w}=await d.from("products").select("id",{count:"exact",head:!0});if(w)throw w;const{data:I,error:S}=await d.from("products").select("id, name, sku, stock_quantity, min_stock_level, selling_price").limit(25);if(S)throw S;const k=(I||[]).filter(t=>(t.stock_quantity??0)<=(t.min_stock_level??0));if(!s)return;D((i||[]).map(t=>{var o;return{id:t.id,customer:t.customer_name||"â€”",amount:Number(t.total_amount||0),items:Array.isArray(t.transaction_items)&&t.transaction_items.length>0&&((o=t.transaction_items[0])==null?void 0:o.count)!=null?t.transaction_items[0].count:void 0,time:new Date(t.processed_at).toLocaleString(),status:t.status||"completed"}}));const M=(b||[]).reduce((t,o)=>t+Number(o.total_amount||0),0),$=(b||[]).length;P(k.slice(0,5).map(t=>({id:t.id,name:t.name,sku:t.sku,currentStock:t.stock_quantity??0,minStock:t.min_stock_level??0,price:Number(t.selling_price||0)}))),L({todaySales:M,transactionsToday:$,totalProducts:F||0,lowStockCount:k.length})}catch(i){console.error("Dashboard load error:",i),s&&g(i.message||"Failed to load dashboard")}finally{s&&h(!1)}};n();const p=U("transaction:completed",()=>n());return()=>{s=!1,p&&p()}},[N]);const C=a.useMemo(()=>[{title:"Today's Sales",value:y.format(l.todaySales),change:"",changeType:"neutral",icon:q,color:"bg-green-500"},{title:"Total Products",value:`${l.totalProducts}`,change:"",changeType:"neutral",icon:m,color:"bg-blue-500"},{title:"Transactions (Today)",value:`${l.transactionsToday}`,change:"",changeType:"neutral",icon:x,color:"bg-purple-500"},{title:"Low Stock Items",value:`${l.lowStockCount}`,change:"",changeType:"neutral",icon:u,color:"bg-orange-500"}],[l]);return T?e.jsx(R,{text:"Loading dashboard..."}):j?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded",children:["Failed to load dashboard: ",j]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Overview of your store performance"})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 flex space-x-3",children:[e.jsxs(r,{to:"/sales",className:"btn btn-primary btn-md",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"New Sale"]}),e.jsxs(r,{to:"/products",className:"btn btn-secondary btn-md",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Add Product"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:C.map((s,n)=>e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-lg ${s.color}`,children:e.jsx(s.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.value}),e.jsx("span",{className:`ml-2 text-sm font-medium ${s.changeType==="positive"?"text-green-600":"text-red-600"}`,children:s.change})]})]})]})},n))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Transactions"}),e.jsxs(r,{to:"/reports",className:"text-sm text-primary-600 hover:text-primary-500 flex items-center",children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),"View All"]})]})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:A.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"font-medium text-gray-900",children:s.customer})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"font-medium text-gray-900",children:y.format(s.amount)})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"text-gray-900",children:[s.items," items"]})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-gray-500",children:s.time})}),e.jsx("td",{className:"table-cell",children:e.jsx("span",{className:"badge badge-success",children:s.status})})]},s.id))})]})})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Low Stock Alert"}),e.jsxs(r,{to:"/inventory",className:"text-sm text-primary-600 hover:text-primary-500 flex items-center",children:[e.jsx(_,{className:"w-4 h-4 mr-1"}),"Manage"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:E.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["SKU: ",s.sku]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsxs("span",{className:"text-sm text-red-600 font-medium",children:[s.currentStock," in stock"]}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(min: ",s.minStock,")"]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx(u,{className:"w-5 h-5 text-red-500"})})]},s.id))})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Quick Actions"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(r,{to:"/sales",className:"w-full btn btn-primary btn-md justify-start",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Process Sale"]}),e.jsxs(r,{to:"/products",className:"w-full btn btn-secondary btn-md justify-start",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Add Product"]}),e.jsxs(r,{to:"/inventory",className:"w-full btn btn-secondary btn-md justify-start",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Stock Management"]}),e.jsxs(r,{to:"/reports",className:"w-full btn btn-secondary btn-md justify-start",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"View Reports"]})]})})]})]})]})]})};export{B as default};
//# sourceMappingURL=Dashboard-Be22bkuZ.js.map
