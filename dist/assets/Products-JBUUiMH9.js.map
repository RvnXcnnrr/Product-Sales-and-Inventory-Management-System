{"version":3,"file":"Products-JBUUiMH9.js","sources":["../../src/pages/Products.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { \n  Plus, \n  Search, \n  Edit, \n  Trash2, \n  Eye,\n  Package,\n  Save,\n  X\n} from 'lucide-react'\nimport Modal from '../components/ui/Modal'\nimport ConfirmDialog from '../components/ui/ConfirmDialog'\nimport { useForm } from 'react-hook-form'\nimport toast from 'react-hot-toast'\nimport supabase from '../lib/supabase'\nimport { formatCurrency } from '../utils/format'\nimport { useAuth } from '../contexts/AuthContext'\nimport { onAppEvent } from '../lib/eventBus'\nimport { createStoreForUser } from '../utils/store-user-helpers'\n\nconst Products = () => {\n  const [searchTerm, setSearchTerm] = useState('')\n  const [selectedCategory, setSelectedCategory] = useState('all')\n  const [showAddProduct, setShowAddProduct] = useState(false)\n  const [editingProduct, setEditingProduct] = useState(null)\n  const [viewingProduct, setViewingProduct] = useState(null)\n  const [confirmDeleteId, setConfirmDeleteId] = useState(null)\n  const { profile, loading: authLoading } = useAuth()\n\n  // Products from database\n  const [products, setProducts] = useState([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n\n  const [categories, setCategories] = useState(['all'])\n  const [categoryMap, setCategoryMap] = useState(new Map())\n  const [categoriesData, setCategoriesData] = useState([])\n\n  useEffect(() => {\n    let isMounted = true\n    const fetchData = async () => {\n      try {\n        setLoading(true)\n        setError(null)\n\n        if (!profile?.store_id) {\n          if (isMounted) {\n            setProducts([])\n            setCategories(['all'])\n            setCategoriesData([])\n          }\n          return\n        }\n\n        const { data: prodData, error: prodErr } = await supabase\n          .from('products')\n          .select('id, name, sku, barcode, description, cost_price, selling_price, stock_quantity, min_stock_level, image_url, category_id, created_at, updated_at')\n          .eq('store_id', profile.store_id)\n          .order('updated_at', { ascending: false })\n\n        if (prodErr) throw prodErr\n\n        const { data: catData, error: catErr } = await supabase\n          .from('categories')\n          .select('id, name')\n          .eq('store_id', profile.store_id)\n          .order('name')\n\n        if (catErr) throw catErr\n\n        if (!isMounted) return\n        setProducts(prodData || [])\n        const map = new Map((catData || []).map(c => [c.id, c.name]))\n        setCategoryMap(map)\n        setCategoriesData(catData || [])\n        setCategories(['all', ...Array.from(new Set((prodData || []).map(p => map.get(p.category_id)).filter(Boolean)))])\n      } catch (e) {\n        if (!isMounted) return\n        console.error('Failed to load products:', e)\n        setError('Failed to load products')\n      } finally {\n        if (isMounted) setLoading(false)\n      }\n    }\n    if (!authLoading) {\n      fetchData()\n    } else {\n      setLoading(true)\n    }\n    const unsubscribe = onAppEvent('transaction:completed', () => fetchData())\n    return () => { isMounted = false; unsubscribe && unsubscribe() }\n  }, [authLoading, profile?.store_id])\n\n  const {\n    register,\n    handleSubmit,\n    reset,\n    watch,\n    setValue,\n    getValues,\n    formState: { errors }\n  } = useForm()\n\n  // Quick SKU generator if left blank\n  const generateSku = (name = '') => {\n    const prefix = (name || '')\n      .toString()\n      .trim()\n      .toUpperCase()\n      .replace(/[^A-Z0-9]+/g, '')\n      .slice(0, 6) || 'SKU'\n    const suffix = Date.now().toString(36).toUpperCase().slice(-5)\n    return `${prefix}-${suffix}`\n  }\n\n  // Quick add category via prompt\n  const addCategoryQuick = async () => {\n    try {\n      // Resolve store_id from profile or store_users mapping\n      let targetStoreId = profile?.store_id || null\n      if (!targetStoreId && profile?.id) {\n        const { data: su, error: suErr } = await supabase\n          .from('store_users')\n          .select('store_id')\n          .eq('user_id', profile.id)\n          .eq('is_active', true)\n          .limit(1)\n          .maybeSingle()\n        if (suErr && suErr.code !== 'PGRST116') throw suErr\n        if (su?.store_id) targetStoreId = su.store_id\n      }\n      // If still no store, auto-create one and mapping for the user\n      if (!targetStoreId) {\n        if (!profile?.id) {\n          toast.error('You must be signed in')\n          return\n        }\n        const storeName = (profile.full_name || profile.email || 'My Store').toString().split('@')[0] + \"'s Store\"\n        const creating = await createStoreForUser(supabase, profile.id, storeName, 'owner')\n        if (!creating.success || !creating.storeId) {\n          console.error('Auto-create store failed:', creating.error || creating.message)\n          toast.error('Could not create a store for your account')\n          return\n        }\n        targetStoreId = creating.storeId\n      }\n      const name = window.prompt('Enter new category name')\n      if (!name || !name.trim()) return\n      const { data: newCat, error: catErr } = await supabase\n        .from('categories')\n        .insert([{ name: name.trim(), store_id: targetStoreId }])\n        .select()\n        .single()\n      if (catErr) throw catErr\n      setCategoriesData(prev => [...prev, newCat])\n      setCategoryMap(prev => new Map(prev).set(newCat.id, newCat.name))\n      // set selected category in form\n      setValue('category_id', newCat.id)\n      toast.success('Category added')\n    } catch (e) {\n      console.error('Failed to add category:', e)\n      // Permission or RLS error\n      if (e?.code === '42501' || e?.message?.toLowerCase?.().includes('permission') || e?.message?.toLowerCase?.().includes('policy')) {\n        toast.error('You do not have permission to add categories')\n      } else {\n        toast.error('Failed to add category')\n      }\n    }\n  }\n\n  const filteredProducts = products.filter(product => {\n    const matchesSearch = product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         product.sku.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                         (product.barcode || '').includes(searchTerm)\n    const productCatName = categoryMap.get(product.category_id)\n    const matchesCategory = selectedCategory === 'all' || productCatName === selectedCategory\n    return matchesSearch && matchesCategory\n  })\n\n  const handleAddProduct = async (data) => {\n    try {\n      let currentStoreId = profile?.store_id || null\n      if (!currentStoreId && profile?.id) {\n        const { data: su, error: suErr } = await supabase\n          .from('store_users')\n          .select('store_id')\n          .eq('user_id', profile.id)\n          .eq('is_active', true)\n          .limit(1)\n          .maybeSingle()\n        if (suErr && suErr.code !== 'PGRST116') throw suErr\n        if (su?.store_id) currentStoreId = su.store_id\n      }\n      // If still missing, auto-create a store and mapping\n      if (!currentStoreId) {\n        if (!profile?.id) {\n          toast.error('You must be signed in')\n          return\n        }\n        const storeName = (profile.full_name || profile.email || 'My Store').toString().split('@')[0] + \"'s Store\"\n        const creating = await createStoreForUser(supabase, profile.id, storeName, 'owner')\n        if (!creating.success || !creating.storeId) {\n          console.error('Auto-create store failed:', creating.error || creating.message)\n          toast.error('Could not create a store for your account')\n          return\n        }\n        currentStoreId = creating.storeId\n      }\n      // Normalize and auto-generate SKU if empty\n      let sku = (data.sku || '').trim()\n      if (!sku) {\n        sku = generateSku(data.name)\n      }\n\n      // Pre-check duplicate SKU in this store\n      const { data: existingSku, error: skuErr } = await supabase\n        .from('products')\n        .select('id')\n  .eq('store_id', currentStoreId)\n        .eq('sku', sku)\n        .maybeSingle()\n      if (skuErr && skuErr.code !== 'PGRST116') {\n        // PGRST116 is no rows when using single/maybeSingle\n        throw skuErr\n      }\n      if (existingSku) {\n        toast.error('SKU already exists in your store')\n        return\n      }\n\n      const payload = {\n        ...data,\n        sku,\n        cost_price: parseFloat(data.cost_price),\n        selling_price: parseFloat(data.selling_price),\n        stock_quantity: parseInt(data.stock_quantity),\n        min_stock_level: parseInt(data.min_stock_level),\n  store_id: currentStoreId\n      }\n      const { data: inserted, error } = await supabase\n        .from('products')\n        .insert([payload])\n        .select()\n      if (error) {\n        // Handle unique violation gracefully\n        if (error.code === '23505') {\n          toast.error('SKU already exists')\n          return\n        }\n        throw error\n      }\n      // Log initial stock if any\n      const created = inserted?.[0]\n      if (created && payload.stock_quantity > 0) {\n        try {\n          await supabase.from('inventory_logs').insert([{\n            product_id: created.id,\n            store_id: currentStoreId,\n            type: 'stock_in',\n            quantity_change: payload.stock_quantity,\n            previous_quantity: 0,\n            new_quantity: payload.stock_quantity,\n            reason: 'initial_stock',\n            notes: 'Initial stock on product creation',\n            created_by: profile.id\n          }])\n        } catch (logErr) {\n          console.warn('Inventory log failed:', logErr)\n        }\n      }\n      setProducts([...(inserted || []), ...products])\n      setShowAddProduct(false)\n      reset()\n      toast.success('Product added successfully!')\n    } catch (e) {\n      console.error(e)\n      toast.error('Failed to add product')\n    }\n  }\n\n  const handleEditProduct = async (data) => {\n    try {\n      // Ensure SKU cannot be blank on edit\n      const nextSku = (data.sku || '').trim() || editingProduct.sku\n      const payload = {\n        ...data,\n        sku: nextSku,\n        cost_price: parseFloat(data.cost_price),\n        selling_price: parseFloat(data.selling_price),\n        stock_quantity: parseInt(data.stock_quantity),\n        min_stock_level: parseInt(data.min_stock_level)\n      }\n      const { data: updated, error } = await supabase\n        .from('products')\n        .update(payload)\n        .eq('id', editingProduct.id)\n        .select()\n      if (error) throw error\n      const updatedProducts = products.map(p => p.id === editingProduct.id ? updated[0] : p)\n      setProducts(updatedProducts)\n      setEditingProduct(null)\n      reset()\n      toast.success('Product updated successfully!')\n    } catch (e) {\n      console.error(e)\n      toast.error('Failed to update product')\n    }\n  }\n\n  const handleDeleteProduct = (productId) => {\n    setConfirmDeleteId(productId)\n  }\n  const confirmDelete = () => {\n    if (confirmDeleteId == null) return\n    // Delete in DB then update state\n    supabase.from('products').delete().eq('id', confirmDeleteId)\n      .then(({ error }) => {\n        if (error) {\n          console.error(error)\n          toast.error('Failed to delete product')\n        } else {\n          setProducts(products.filter(product => product.id !== confirmDeleteId))\n          toast.success('Product deleted successfully!')\n        }\n  })\n  }\n\n  const getStockStatus = (product) => {\n    if (product.stock_quantity === 0) {\n      return { status: 'out', color: 'text-red-600', bg: 'bg-red-100' }\n    } else if (product.stock_quantity <= product.min_stock_level) {\n      return { status: 'low', color: 'text-orange-600', bg: 'bg-orange-100' }\n    }\n    return { status: 'good', color: 'text-green-600', bg: 'bg-green-100' }\n  }\n\n  const ProductForm = ({ product, onSubmit, onCancel }) => {\n    const cost = parseFloat(watch('cost_price') || 0)\n    const price = parseFloat(watch('selling_price') || 0)\n    const margin = Math.max(price - cost, 0)\n    const marginPct = price > 0 ? (margin / price) * 100 : 0\n    const isEditing = !!product\n    return (\n      <form onSubmit={handleSubmit(onSubmit)} className=\"p-6 space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <label className=\"label\">Product Name *</label>\n            <input\n              {...register('name', { required: 'Product name is required' })}\n              className=\"input\"\n              defaultValue={product?.name}\n              placeholder=\"Enter product name\"\n            />\n            {errors.name && <p className=\"text-sm text-red-600 mt-1\">{errors.name.message}</p>}\n          </div>\n\n          <div>\n            <label className=\"label\">SKU {isEditing ? '*' : ''}</label>\n            <input\n              {...register('sku')}\n              className=\"input\"\n              defaultValue={product?.sku}\n              placeholder={isEditing ? 'Enter SKU' : 'Leave blank to auto-generate'}\n            />\n            {errors.sku && <p className=\"text-sm text-red-600 mt-1\">{errors.sku.message}</p>}\n          </div>\n\n          <div>\n            <label className=\"label\">Barcode</label>\n            <input\n              {...register('barcode')}\n              className=\"input\"\n              defaultValue={product?.barcode}\n              placeholder=\"Enter barcode\"\n            />\n          </div>\n\n          <div>\n            <div className=\"flex items-center justify-between\">\n              <label className=\"label\">Category *</label>\n              <button type=\"button\" onClick={addCategoryQuick} className=\"text-sm text-primary-600 hover:text-primary-500 inline-flex items-center\">\n                <Plus className=\"w-3 h-3 mr-1\" /> Add new\n              </button>\n            </div>\n            <select\n              {...register('category_id', { required: 'Category is required' })}\n              className=\"input\"\n              defaultValue={product?.category_id || ''}\n            >\n              <option value=\"\">Select category</option>\n              {categoriesData.map(cat => (\n                <option key={cat.id} value={cat.id}>{cat.name}</option>\n              ))}\n            </select>\n            {errors.category_id && <p className=\"text-sm text-red-600 mt-1\">{errors.category_id.message}</p>}\n          </div>\n\n          <div>\n            <label className=\"label\">Cost Price *</label>\n            <input\n              type=\"number\"\n              step=\"0.01\"\n              {...register('cost_price', {\n                required: 'Cost price is required',\n                min: { value: 0, message: 'Cost price must be positive' }\n              })}\n              className=\"input\"\n              defaultValue={product?.cost_price}\n              placeholder=\"0.00\"\n            />\n            {errors.cost_price && <p className=\"text-sm text-red-600 mt-1\">{errors.cost_price.message}</p>}\n          </div>\n\n          <div>\n            <label className=\"label\">Selling Price *</label>\n            <input\n              type=\"number\"\n              step=\"0.01\"\n              {...register('selling_price', {\n                required: 'Selling price is required',\n                min: { value: 0, message: 'Selling price must be positive' },\n                validate: (v) => parseFloat(v || 0) >= parseFloat(getValues('cost_price') || 0) || 'Selling must be greater than or equal to cost'\n              })}\n              className=\"input\"\n              defaultValue={product?.selling_price}\n              placeholder=\"0.00\"\n            />\n            <p className=\"text-xs text-gray-500 mt-1\">Margin: {formatCurrency(margin)} ({marginPct.toFixed(1)}%)</p>\n            {errors.selling_price && <p className=\"text-sm text-red-600 mt-1\">{errors.selling_price.message}</p>}\n          </div>\n\n          <div>\n            <label className=\"label\">Stock Quantity *</label>\n            <input\n              type=\"number\"\n              {...register('stock_quantity', {\n                required: 'Stock quantity is required',\n                min: { value: 0, message: 'Stock quantity must be positive' }\n              })}\n              className=\"input\"\n              defaultValue={product?.stock_quantity}\n              placeholder=\"0\"\n            />\n            {errors.stock_quantity && <p className=\"text-sm text-red-600 mt-1\">{errors.stock_quantity.message}</p>}\n          </div>\n\n          <div>\n            <label className=\"label\">Minimum Stock Level</label>\n            <input\n              type=\"number\"\n              {...register('min_stock_level', {\n                min: { value: 0, message: 'Minimum stock must be positive' }\n              })}\n              className=\"input\"\n              defaultValue={product?.min_stock_level || 0}\n              placeholder=\"0\"\n            />\n            {errors.min_stock_level && <p className=\"text-sm text-red-600 mt-1\">{errors.min_stock_level.message}</p>}\n          </div>\n        </div>\n\n        <div>\n          <label className=\"label\">Description</label>\n          <textarea\n            {...register('description')}\n            className=\"input h-24 resize-none\"\n            defaultValue={product?.description}\n            placeholder=\"Enter product description\"\n          />\n        </div>\n\n        <div className=\"flex justify-end space-x-3 pt-4 border-t\">\n          <button\n            type=\"button\"\n            onClick={onCancel}\n            className=\"btn btn-secondary btn-md\"\n          >\n            <X className=\"w-4 h-4 mr-2\" />\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            className=\"btn btn-primary btn-md\"\n          >\n            <Save className=\"w-4 h-4 mr-2\" />\n            {isEditing ? 'Update Product' : 'Add Product'}\n          </button>\n        </div>\n      </form>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Products</h1>\n          <p className=\"mt-1 text-sm text-gray-500\">\n            Manage your product catalog and inventory\n          </p>\n        </div>\n        <button\n          onClick={() => setShowAddProduct(true)}\n          className=\"btn btn-primary btn-md mt-4 sm:mt-0\"\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Add Product\n        </button>\n      </div>\n\n      {/* Search and Filters */}\n      <div className=\"card p-4\">\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          <div className=\"flex-1 relative\">\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search products by name, SKU, or barcode...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"input pl-10\"\n            />\n          </div>\n          <select\n            value={selectedCategory}\n            onChange={(e) => setSelectedCategory(e.target.value)}\n            className=\"input w-full sm:w-auto\"\n          >\n            {categories.map(category => (\n              <option key={category} value={category}>\n                {category === 'all' ? 'All Categories' : category}\n              </option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      {/* Products Table */}\n      <div className=\"card overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200\">\n            <thead className=\"table-header\">\n              <tr>\n                <th className=\"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Product\n                </th>\n                <th className=\"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  SKU\n                </th>\n                <th className=\"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Category\n                </th>\n                <th className=\"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Price\n                </th>\n                <th className=\"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Stock\n                </th>\n                <th className=\"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Status\n                </th>\n                <th className=\"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                  Actions\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {loading ? (\n                <tr><td className=\"table-cell p-6\" colSpan=\"7\">Loading...</td></tr>\n              ) : error ? (\n                <tr><td className=\"table-cell p-6 text-red-600\" colSpan=\"7\">{error}</td></tr>\n              ) : filteredProducts.map((product) => {\n                const stockStatus = getStockStatus(product)\n                return (\n                  <tr key={product.id} className=\"hover:bg-gray-50\">\n                    <td className=\"table-cell\">\n                      <div className=\"flex items-center\">\n                        <div className=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3\">\n                          {product.image_url ? (\n                            <img \n                              src={product.image_url} \n                              alt={product.name}\n                              className=\"w-full h-full object-cover rounded-lg\"\n                            />\n                          ) : (\n                            <Package className=\"w-5 h-5 text-gray-400\" />\n                          )}\n                        </div>\n                        <div>\n                          <div className=\"font-medium text-gray-900\">{product.name}</div>\n                          <div className=\"text-sm text-gray-500 truncate max-w-xs\">\n                            {product.description}\n                          </div>\n                        </div>\n                      </div>\n                    </td>\n                    <td className=\"table-cell\">\n                      <div className=\"text-sm font-mono\">{product.sku}</div>\n                    </td>\n                    <td className=\"table-cell\">\n                      <span className=\"badge badge-info\">{categoryMap.get(product.category_id) || 'Uncategorized'}</span>\n                    </td>\n                    <td className=\"table-cell\">\n                      <div className=\"text-sm\">\n                        <div className=\"font-medium\">{formatCurrency(product.selling_price)}</div>\n                        <div className=\"text-gray-500\">Cost: {formatCurrency(product.cost_price)}</div>\n                      </div>\n                    </td>\n                    <td className=\"table-cell\">\n                      <div className=\"text-sm\">\n                        <div className=\"font-medium\">{product.stock_quantity}</div>\n                        <div className=\"text-gray-500\">Min: {product.min_stock_level}</div>\n                      </div>\n                    </td>\n                    <td className=\"table-cell\">\n                      <span className={`badge ${stockStatus.bg} ${stockStatus.color}`}>\n                        {stockStatus.status === 'out' ? 'Out of Stock' :\n                         stockStatus.status === 'low' ? 'Low Stock' : 'In Stock'}\n                      </span>\n                    </td>\n                    <td className=\"table-cell\">\n                      <div className=\"flex items-center space-x-2\">\n                        <button\n                          onClick={() => setViewingProduct(product)}\n                          className=\"text-gray-400 hover:text-blue-600 transition-colors\"\n                          title=\"View Details\"\n                        >\n                          <Eye className=\"w-4 h-4\" />\n                        </button>\n                        <button\n                          onClick={() => {\n                            setEditingProduct(product)\n                            reset(product)\n                          }}\n                          className=\"text-gray-400 hover:text-green-600 transition-colors\"\n                          title=\"Edit Product\"\n                        >\n                          <Edit className=\"w-4 h-4\" />\n                        </button>\n                        <button\n                          onClick={() => handleDeleteProduct(product.id)}\n                          className=\"text-gray-400 hover:text-red-600 transition-colors\"\n                          title=\"Delete Product\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </button>\n                      </div>\n                    </td>\n                  </tr>\n                )\n              })}\n            </tbody>\n          </table>\n        </div>\n\n  {filteredProducts.length === 0 && !loading && !error && (\n          <div className=\"text-center py-12\">\n            <Package className=\"w-12 h-12 text-gray-300 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No products found</h3>\n            <p className=\"text-gray-500\">Try adjusting your search or add a new product</p>\n          </div>\n        )}\n      </div>\n\n      {/* Add Product Modal */}\n      <Modal\n        isOpen={showAddProduct}\n        onClose={() => {\n          setShowAddProduct(false)\n          reset()\n        }}\n        title=\"Add New Product\"\n        size=\"lg\"\n      >\n        <ProductForm\n          onSubmit={handleAddProduct}\n          onCancel={() => {\n            setShowAddProduct(false)\n            reset()\n          }}\n        />\n      </Modal>\n\n      {/* Edit Product Modal */}\n      <Modal\n        isOpen={!!editingProduct}\n        onClose={() => {\n          setEditingProduct(null)\n          reset()\n        }}\n        title=\"Edit Product\"\n        size=\"lg\"\n      >\n        <ProductForm\n          product={editingProduct}\n          onSubmit={handleEditProduct}\n          onCancel={() => {\n            setEditingProduct(null)\n            reset()\n          }}\n        />\n      </Modal>\n\n      {/* View Product Modal */}\n      <Modal\n        isOpen={!!viewingProduct}\n        onClose={() => setViewingProduct(null)}\n        title=\"Product Details\"\n        size=\"md\"\n      >\n        {viewingProduct && (\n          <div className=\"p-6 space-y-6\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center\">\n                {viewingProduct.image_url ? (\n                  <img \n                    src={viewingProduct.image_url} \n                    alt={viewingProduct.name}\n                    className=\"w-full h-full object-cover rounded-lg\"\n                  />\n                ) : (\n                  <Package className=\"w-8 h-8 text-gray-400\" />\n                )}\n              </div>\n              <div>\n                <h3 className=\"text-xl font-bold text-gray-900\">{viewingProduct.name}</h3>\n                <p className=\"text-gray-500\">{categoryMap.get(viewingProduct.category_id) || 'Uncategorized'}</p>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm font-medium text-gray-500\">SKU</label>\n                <p className=\"font-mono\">{viewingProduct.sku}</p>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-gray-500\">Barcode</label>\n                <p className=\"font-mono\">{viewingProduct.barcode || 'N/A'}</p>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-gray-500\">Cost Price</label>\n                <p>{formatCurrency(viewingProduct.cost_price)}</p>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-gray-500\">Selling Price</label>\n                <p className=\"font-semibold\">{formatCurrency(viewingProduct.selling_price)}</p>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-gray-500\">Stock Quantity</label>\n                <p>{viewingProduct.stock_quantity}</p>\n              </div>\n              <div>\n                <label className=\"text-sm font-medium text-gray-500\">Min Stock Level</label>\n                <p>{viewingProduct.min_stock_level}</p>\n              </div>\n            </div>\n\n            {viewingProduct.description && (\n              <div>\n                <label className=\"text-sm font-medium text-gray-500\">Description</label>\n                <p className=\"text-gray-900\">{viewingProduct.description}</p>\n              </div>\n            )}\n\n            <div className=\"grid grid-cols-2 gap-4 text-sm text-gray-500\">\n              <div>\n                <label className=\"font-medium\">Created</label>\n                <p>{new Date(viewingProduct.created_at).toLocaleDateString()}</p>\n              </div>\n              <div>\n                <label className=\"font-medium\">Last Updated</label>\n                <p>{new Date(viewingProduct.updated_at).toLocaleDateString()}</p>\n              </div>\n            </div>\n          </div>\n        )}\n      </Modal>\n\n      {/* Delete confirmation */}\n      <ConfirmDialog\n        isOpen={confirmDeleteId != null}\n        onCancel={() => setConfirmDeleteId(null)}\n        onConfirm={confirmDelete}\n        title=\"Delete product?\"\n        description=\"This action cannot be undone. The product will be removed from your catalog.\"\n        confirmText=\"Delete\"\n        variant=\"danger\"\n      />\n    </div>\n  )\n}\n\nexport default Products\n"],"names":["Products","searchTerm","setSearchTerm","useState","selectedCategory","setSelectedCategory","showAddProduct","setShowAddProduct","editingProduct","setEditingProduct","viewingProduct","setViewingProduct","confirmDeleteId","setConfirmDeleteId","profile","authLoading","useAuth","products","setProducts","loading","setLoading","error","setError","categories","setCategories","categoryMap","setCategoryMap","categoriesData","setCategoriesData","useEffect","isMounted","fetchData","prodData","prodErr","supabase","catData","catErr","map","c","p","e","unsubscribe","onAppEvent","register","handleSubmit","reset","watch","setValue","getValues","errors","useForm","generateSku","name","prefix","suffix","addCategoryQuick","targetStoreId","su","suErr","toast","storeName","creating","createStoreForUser","newCat","prev","_b","_a","_d","_c","filteredProducts","product","matchesSearch","productCatName","handleAddProduct","data","currentStoreId","sku","existingSku","skuErr","payload","inserted","created","logErr","handleEditProduct","nextSku","updated","updatedProducts","handleDeleteProduct","productId","confirmDelete","getStockStatus","ProductForm","onSubmit","onCancel","cost","price","margin","marginPct","isEditing","jsxs","jsx","Plus","cat","v","formatCurrency","X","Save","Search","category","stockStatus","Package","Eye","Edit","Trash2","Modal","ConfirmDialog"],"mappings":"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"}