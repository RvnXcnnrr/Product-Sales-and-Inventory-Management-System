import{d as $,r as a,a as ie,c as xe,j as e,P as R,f as M,A as me,M as z,C as ue,s as x,V as F}from"./index-lSf8Or_v.js";import{o as he}from"./eventBus-DPsVa6OD.js";import{D as ge}from"./download-DbEYSR_F.js";import{T as pe}from"./trending-up-Bxv33aBt.js";import{S as je,P as ye}from"./search-CjY5xoAW.js";import{P as ke}from"./pen-square-p8pL3Dzn.js";import{M as fe}from"./minus-D-XlWV-l.js";/**
 * @license lucide-react v0.307.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=$("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.307.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=$("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),Me=()=>{const[k,K]=a.useState(""),[f,Q]=a.useState("all"),[m,B]=a.useState("all"),[Y,u]=a.useState(!1),[c,h]=a.useState(null),[G,L]=a.useState(!1),[A,J]=a.useState(null),[W,v]=a.useState(!1),{profile:l,user:N,loading:T}=ie(),[X,b]=a.useState(!0),[Z,P]=a.useState(null),[D,_]=a.useState([]),[ee,O]=a.useState(new Map),[te,E]=a.useState(["all"]),[w,S]=a.useState([]),{register:C,handleSubmit:se,reset:q,formState:{errors:g}}=xe(),d=D.map(t=>({id:t.id,name:t.name,sku:t.sku,category:ee.get(t.category_id)||"Uncategorized",current_stock:t.stock_quantity,min_stock_level:t.min_stock_level||0,max_stock_level:t.max_stock_level||0,cost_price:Number(t.cost_price)||0,selling_price:Number(t.selling_price)||0,total_value:(Number(t.stock_quantity)||0)*(Number(t.cost_price)||0),last_updated:t.updated_at,supplier:"-",location:"-"}));a.useEffect(()=>{let t=!0;const s=async()=>{try{if(b(!0),P(null),!(l!=null&&l.store_id)){t&&(_([]),O(new Map),E(["all"]),S([]));return}const[{data:r,error:i},{data:p,error:j}]=await Promise.all([x.from("products").select("id, name, sku, stock_quantity, min_stock_level, max_stock_level, cost_price, selling_price, category_id, updated_at").eq("store_id",l.store_id).order("updated_at",{ascending:!1}),x.from("categories").select("id, name").eq("store_id",l.store_id).order("name")]);if(i)throw i;if(j)throw j;const o=new Map((p||[]).map(y=>[y.id,y.name]));if(!t)return;_(r||[]),O(o),E(["all",...Array.from(new Set((r||[]).map(y=>o.get(y.category_id)).filter(Boolean)))]);const{data:de,error:H}=await x.from("inventory_logs").select("id, type, quantity_change, reason, created_at, product:products(name, sku)").eq("store_id",l.store_id).order("created_at",{ascending:!1}).limit(50);if(H)throw H;S(de||[])}catch(r){console.error(r),P("Failed to load inventory")}finally{t&&b(!1)}};T?b(!0):s();const n=he("transaction:completed",()=>s());return()=>{t=!1,n&&n()}},[T,l==null?void 0:l.store_id]);const ae=te,re=t=>t.current_stock===0?{status:"out",label:"Out of Stock",color:"text-red-600",bg:"bg-red-100"}:t.current_stock<=t.min_stock_level?{status:"low",label:"Low Stock",color:"text-orange-600",bg:"bg-orange-100"}:t.current_stock>=t.max_stock_level*.8?{status:"high",label:"High Stock",color:"text-blue-600",bg:"bg-blue-100"}:{status:"good",label:"Normal",color:"text-green-600",bg:"bg-green-100"},I=d.filter(t=>{const s=t.name.toLowerCase().includes(k.toLowerCase())||t.sku.toLowerCase().includes(k.toLowerCase()),n=f==="all"||t.category===f;let r=!0;return m==="low"?r=t.current_stock<=t.min_stock_level:m==="out"?r=t.current_stock===0:m==="normal"&&(r=t.current_stock>t.min_stock_level),s&&n&&r}),le=d.reduce((t,s)=>t+s.total_value,0),ce=d.filter(t=>t.current_stock<=t.min_stock_level).length,ne=d.filter(t=>t.current_stock===0).length,U=async t=>{if(c)try{const s=c.id,n=c.current_stock,r=Math.max(0,n+t),{error:i}=await x.from("products").update({stock_quantity:r}).eq("id",s).select();if(i)throw i;const{error:p}=await x.from("inventory_logs").insert([{product_id:s,store_id:(l==null?void 0:l.store_id)||null,type:(t>=0,"adjustment"),quantity_change:t,previous_quantity:n,new_quantity:r,reason:"Manual adjustment",reference_type:"manual",created_by:(N==null?void 0:N.id)||null,notes:""}]);if(p)throw p;_(D.map(o=>o.id===s?{...o,stock_quantity:r,updated_at:new Date().toISOString()}:o)),S([{id:Date.now(),type:"adjustment",quantity_change:t,reason:"Manual adjustment",created_at:new Date().toISOString(),product:{name:c.name,sku:c.sku}},...w]),u(!1),h(null),q();const j=t>0?"increased":"decreased";F.success(`Stock ${j} successfully!`)}catch(s){console.error(s),F.error("Failed to update stock")}},oe=t=>{const s=parseInt(t.adjustment);if(s<0){J(s),v(!0);return}U(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Inventory Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-300",children:"Monitor and manage your stock levels"})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 flex space-x-3",children:[e.jsxs("button",{onClick:()=>L(!0),className:"btn btn-secondary btn-md",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Stock History"]}),e.jsxs("button",{className:"btn btn-secondary btn-md",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-blue-500",children:e.jsx(R,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Total Products"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d.length})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-500",children:e.jsx(pe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Total Value"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:M(le)})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-orange-500",children:e.jsx(me,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Low Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:ce})]})]})}),e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-3 rounded-lg bg-red-500",children:e.jsx(ve,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"Out of Stock"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:ne})]})]})})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search by product name or SKU...",value:k,onChange:t=>K(t.target.value),className:"input pl-10"})]}),e.jsx("select",{value:f,onChange:t=>Q(t.target.value),className:"input w-full lg:w-auto",children:ae.map(t=>e.jsx("option",{value:t,children:t==="all"?"All Categories":t},t))}),e.jsxs("select",{value:m,onChange:t=>B(t.target.value),className:"input w-full lg:w-auto",children:[e.jsx("option",{value:"all",children:"All Stock Levels"}),e.jsx("option",{value:"normal",children:"Normal Stock"}),e.jsx("option",{value:"low",children:"Low Stock"}),e.jsx("option",{value:"out",children:"Out of Stock"})]})]})}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Current Stock"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Min/Max"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Location"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:I.map(t=>{const s=re(t);return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"table-cell",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono",children:t.sku})]})}),e.jsx("td",{className:"table-cell",children:e.jsx("span",{className:"badge badge-info",children:t.category})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"font-medium text-lg",children:t.current_stock})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:["Min: ",t.min_stock_level]}),e.jsxs("div",{children:["Max: ",t.max_stock_level]})]})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:M(t.total_value)}),e.jsxs("div",{className:"text-gray-500 dark:text-gray-400",children:[M(t.cost_price)," each"]})]})}),e.jsx("td",{className:"table-cell",children:e.jsx("span",{className:`badge ${s.bg} ${s.color}`,children:s.label})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-sm font-mono",children:t.location})}),e.jsx("td",{className:"table-cell",children:e.jsxs("button",{onClick:()=>{h(t),u(!0)},className:"btn btn-secondary btn-sm",children:[e.jsx(ke,{className:"w-4 h-4 mr-1"}),"Adjust"]})})]},t.id)})})]})}),I.length===0&&!X&&!Z&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No inventory found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Try adjusting your search or filters"})]})]}),e.jsx(z,{isOpen:Y,onClose:()=>{u(!1),h(null),q()},title:"Adjust Stock Level",size:"md",children:c&&e.jsxs("form",{onSubmit:se(oe),className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:c.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["SKU: ",c.sku]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Current Stock: ",c.current_stock]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stock Adjustment"}),e.jsx("input",{type:"number",...C("adjustment",{required:"Adjustment amount is required",validate:t=>{const s=parseInt(t);return s===0?"Adjustment cannot be zero":c.current_stock+s<0?"Cannot reduce stock below zero":!0}}),className:"input",placeholder:"Enter positive number to add, negative to remove"}),g.adjustment&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:g.adjustment.message}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Use positive numbers to increase stock, negative to decrease"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Reason"}),e.jsxs("select",{...C("reason",{required:"Reason is required"}),className:"input",children:[e.jsx("option",{value:"",children:"Select reason"}),e.jsx("option",{value:"Purchase Order",children:"Purchase Order"}),e.jsx("option",{value:"Stock Return",children:"Stock Return"}),e.jsx("option",{value:"Damage/Loss",children:"Damage/Loss"}),e.jsx("option",{value:"Theft",children:"Theft"}),e.jsx("option",{value:"Manual Correction",children:"Manual Correction"}),e.jsx("option",{value:"Transfer",children:"Transfer"}),e.jsx("option",{value:"Other",children:"Other"})]}),g.reason&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:g.reason.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes (Optional)"}),e.jsx("textarea",{...C("notes"),className:"input h-20 resize-none",placeholder:"Additional notes about this adjustment"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),h(null),q()},className:"btn btn-secondary btn-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary btn-md",children:"Update Stock"})]})]})}),e.jsx(ue,{isOpen:W,onCancel:()=>v(!1),onConfirm:()=>{typeof A=="number"&&U(A),v(!1)},title:"Reduce stock?",description:"You're about to reduce the stock quantity. This will update current stock and cannot be undone.",confirmText:"Reduce",variant:"danger"}),e.jsx(z,{isOpen:G,onClose:()=>L(!1),title:"Stock Movement History",size:"lg",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"space-y-4",children:w.map(t=>{var s;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.quantity_change>=0?"bg-green-100":"bg-red-100"}`,children:t.quantity_change>=0?e.jsx(ye,{className:"w-4 h-4 text-green-600"}):e.jsx(fe,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:((s=t.product)==null?void 0:s.name)||"Product"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.reason||"Adjustment"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.quantity_change>=0?"Increase":"Decrease"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-medium ${t.quantity_change>0?"text-green-600":"text-red-600"}`,children:[t.quantity_change>0?"+":"",t.quantity_change]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(t.created_at).toLocaleDateString()})]})]},t.id)})}),w.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No stock movements recorded"})]})]})})]})};export{Me as default};
//# sourceMappingURL=Inventory-DKzXKoiO.js.map
