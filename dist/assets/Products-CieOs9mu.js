import{r as i,b as Y,c as Z,j as e,P as q,f as _,E as ee,M as D,C as se,s as h,X as te,V as m}from"./index-DhFL0F8I.js";import{P as ae,S as le}from"./search-jvWA0UuF.js";import{P as re}from"./pen-square-CSwJsVhs.js";import{T as ie}from"./trash-2-DelcfTuy.js";import{S as ce}from"./save-Bv-JYpW0.js";const ue=()=>{const[g,z]=i.useState(""),[k,K]=i.useState("all"),[O,j]=i.useState(!1),[p,f]=i.useState(null),[a,E]=i.useState(null),[N,w]=i.useState(null),{profile:n,loading:L}=Y(),[y,x]=i.useState([]),[V,S]=i.useState(!0),[C,M]=i.useState(null),[B,A]=i.useState(["all"]),[P,Q]=i.useState(new Map),[$,F]=i.useState([]);i.useEffect(()=>{let s=!0;return L?S(!0):(async()=>{try{if(S(!0),M(null),!(n!=null&&n.store_id)){s&&(x([]),A(["all"]),F([]));return}const{data:c,error:r}=await h.from("products").select("id, name, sku, barcode, description, cost_price, selling_price, stock_quantity, min_stock_level, image_url, category_id, created_at, updated_at").eq("store_id",n.store_id).order("updated_at",{ascending:!1});if(r)throw r;const{data:b,error:u}=await h.from("categories").select("id, name").eq("store_id",n.store_id).order("name");if(u)throw u;if(!s)return;x(c||[]);const I=new Map((b||[]).map(v=>[v.id,v.name]));Q(I),F(b||[]),A(["all",...Array.from(new Set((c||[]).map(v=>I.get(v.category_id)).filter(Boolean)))])}catch(c){if(!s)return;console.error("Failed to load products:",c),M("Failed to load products")}finally{s&&S(!1)}})(),()=>{s=!1}},[L,n==null?void 0:n.store_id]);const{register:d,handleSubmit:R,reset:o,formState:{errors:l}}=Z(),U=y.filter(s=>{const t=s.name.toLowerCase().includes(g.toLowerCase())||s.sku.toLowerCase().includes(g.toLowerCase())||(s.barcode||"").includes(g),c=P.get(s.category_id);return t&&(k==="all"||c===k)}),X=async s=>{try{const t={...s,cost_price:parseFloat(s.cost_price),selling_price:parseFloat(s.selling_price),stock_quantity:parseInt(s.stock_quantity),min_stock_level:parseInt(s.min_stock_level),store_id:(n==null?void 0:n.store_id)||null},{data:c,error:r}=await h.from("products").insert([t]).select();if(r)throw r;x([...c||[],...y]),j(!1),o(),m.success("Product added successfully!")}catch(t){console.error(t),m.error("Failed to add product")}},G=async s=>{try{const t={...s,cost_price:parseFloat(s.cost_price),selling_price:parseFloat(s.selling_price),stock_quantity:parseInt(s.stock_quantity),min_stock_level:parseInt(s.min_stock_level)},{data:c,error:r}=await h.from("products").update(t).eq("id",p.id).select();if(r)throw r;const b=y.map(u=>u.id===p.id?c[0]:u);x(b),f(null),o(),m.success("Product updated successfully!")}catch(t){console.error(t),m.error("Failed to update product")}},H=s=>{w(s)},J=()=>{N!=null&&(h.from("products").delete().eq("id",N).then(({error:s})=>{s?(console.error(s),m.error("Failed to delete product")):(x(y.filter(t=>t.id!==N)),m.success("Product deleted successfully!"))}),w(null))},W=s=>s.stock_quantity===0?{status:"out",color:"text-red-600",bg:"bg-red-100"}:s.stock_quantity<=s.min_stock_level?{status:"low",color:"text-orange-600",bg:"bg-orange-100"}:{status:"good",color:"text-green-600",bg:"bg-green-100"},T=({product:s,onSubmit:t,onCancel:c})=>e.jsxs("form",{onSubmit:R(t),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Product Name *"}),e.jsx("input",{...d("name",{required:"Product name is required"}),className:"input",defaultValue:s==null?void 0:s.name,placeholder:"Enter product name"}),l.name&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"SKU *"}),e.jsx("input",{...d("sku",{required:"SKU is required"}),className:"input",defaultValue:s==null?void 0:s.sku,placeholder:"Enter SKU"}),l.sku&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.sku.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Barcode"}),e.jsx("input",{...d("barcode"),className:"input",defaultValue:s==null?void 0:s.barcode,placeholder:"Enter barcode"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Category *"}),e.jsxs("select",{...d("category_id",{required:"Category is required"}),className:"input",defaultValue:(s==null?void 0:s.category_id)||"",children:[e.jsx("option",{value:"",children:"Select category"}),$.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),l.category_id&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.category_id.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Cost Price *"}),e.jsx("input",{type:"number",step:"0.01",...d("cost_price",{required:"Cost price is required",min:{value:0,message:"Cost price must be positive"}}),className:"input",defaultValue:s==null?void 0:s.cost_price,placeholder:"0.00"}),l.cost_price&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.cost_price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Selling Price *"}),e.jsx("input",{type:"number",step:"0.01",...d("selling_price",{required:"Selling price is required",min:{value:0,message:"Selling price must be positive"}}),className:"input",defaultValue:s==null?void 0:s.selling_price,placeholder:"0.00"}),l.selling_price&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.selling_price.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Stock Quantity *"}),e.jsx("input",{type:"number",...d("stock_quantity",{required:"Stock quantity is required",min:{value:0,message:"Stock quantity must be positive"}}),className:"input",defaultValue:s==null?void 0:s.stock_quantity,placeholder:"0"}),l.stock_quantity&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.stock_quantity.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Minimum Stock Level"}),e.jsx("input",{type:"number",...d("min_stock_level",{min:{value:0,message:"Minimum stock must be positive"}}),className:"input",defaultValue:(s==null?void 0:s.min_stock_level)||0,placeholder:"0"}),l.min_stock_level&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:l.min_stock_level.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{...d("description"),className:"input h-24 resize-none",defaultValue:s==null?void 0:s.description,placeholder:"Enter product description"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsxs("button",{type:"button",onClick:c,className:"btn btn-secondary btn-md",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsxs("button",{type:"submit",className:"btn btn-primary btn-md",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),s?"Update Product":"Add Product"]})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Products"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your product catalog and inventory"})]}),e.jsxs("button",{onClick:()=>j(!0),className:"btn btn-primary btn-md mt-4 sm:mt-0",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Add Product"]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"text",placeholder:"Search products by name, SKU, or barcode...",value:g,onChange:s=>z(s.target.value),className:"input pl-10"})]}),e.jsx("select",{value:k,onChange:s=>K(s.target.value),className:"input w-full sm:w-auto",children:B.map(s=>e.jsx("option",{value:s,children:s==="all"?"All Categories":s},s))})]})}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:V?e.jsx("tr",{children:e.jsx("td",{className:"table-cell p-6",colSpan:"7",children:"Loading..."})}):C?e.jsx("tr",{children:e.jsx("td",{className:"table-cell p-6 text-red-600",colSpan:"7",children:C})}):U.map(s=>{const t=W(s);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center mr-3",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover rounded-lg"}):e.jsx(q,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-xs",children:s.description})]})]})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-sm font-mono",children:s.sku})}),e.jsx("td",{className:"table-cell",children:e.jsx("span",{className:"badge badge-info",children:P.get(s.category_id)||"Uncategorized"})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:_(s.selling_price)}),e.jsxs("div",{className:"text-gray-500",children:["Cost: ",_(s.cost_price)]})]})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:s.stock_quantity}),e.jsxs("div",{className:"text-gray-500",children:["Min: ",s.min_stock_level]})]})}),e.jsx("td",{className:"table-cell",children:e.jsx("span",{className:`badge ${t.bg} ${t.color}`,children:t.status==="out"?"Out of Stock":t.status==="low"?"Low Stock":"In Stock"})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>E(s),className:"text-gray-400 hover:text-blue-600 transition-colors",title:"View Details",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{f(s),o(s)},className:"text-gray-400 hover:text-green-600 transition-colors",title:"Edit Product",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>H(s.id),className:"text-gray-400 hover:text-red-600 transition-colors",title:"Delete Product",children:e.jsx(ie,{className:"w-4 h-4"})})]})})]},s.id)})})]})}),U.length===0&&!V&&!C&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your search or add a new product"})]})]}),e.jsx(D,{isOpen:O,onClose:()=>{j(!1),o()},title:"Add New Product",size:"lg",children:e.jsx(T,{onSubmit:X,onCancel:()=>{j(!1),o()}})}),e.jsx(D,{isOpen:!!p,onClose:()=>{f(null),o()},title:"Edit Product",size:"lg",children:e.jsx(T,{product:p,onSubmit:G,onCancel:()=>{f(null),o()}})}),e.jsx(D,{isOpen:!!a,onClose:()=>E(null),title:"Product Details",size:"md",children:a&&e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.name,className:"w-full h-full object-cover rounded-lg"}):e.jsx(q,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:a.name}),e.jsx("p",{className:"text-gray-500",children:P.get(a.category_id)||"Uncategorized"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"SKU"}),e.jsx("p",{className:"font-mono",children:a.sku})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Barcode"}),e.jsx("p",{className:"font-mono",children:a.barcode||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Cost Price"}),e.jsx("p",{children:_(a.cost_price)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Selling Price"}),e.jsx("p",{className:"font-semibold",children:_(a.selling_price)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Stock Quantity"}),e.jsx("p",{children:a.stock_quantity})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Min Stock Level"}),e.jsx("p",{children:a.min_stock_level})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"text-gray-900",children:a.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-500",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:"Created"}),e.jsx("p",{children:new Date(a.created_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"font-medium",children:"Last Updated"}),e.jsx("p",{children:new Date(a.updated_at).toLocaleDateString()})]})]})]})}),e.jsx(se,{isOpen:N!=null,onCancel:()=>w(null),onConfirm:J,title:"Delete product?",description:"This action cannot be undone. The product will be removed from your catalog.",confirmText:"Delete",variant:"danger"})]})};export{ue as default};
//# sourceMappingURL=Products-CieOs9mu.js.map
