import{r,u as O,a as R,P as x,S as u,A as h,j as e,L as U,b as c,E as T,s as d}from"./index-Ck3Yh7nW.js";import{o as V}from"./eventBus-DPsVa6OD.js";import{D as H}from"./dollar-sign-D9X1PUEU.js";import{T as K}from"./trending-up-CBBS2HpT.js";const J=()=>{const[A,y]=r.useState(!0),[g,j]=r.useState(null),[D,E]=r.useState([]),[P,L]=r.useState([]),[l,C]=r.useState({todaySales:0,transactionsToday:0,totalProducts:0,lowStockCount:0}),{settings:a}=O(),{profile:n}=R(),N=r.useMemo(()=>{try{return new Intl.NumberFormat(void 0,{style:"currency",currency:(a==null?void 0:a.currency)||"USD",maximumFractionDigits:2})}catch{return new Intl.NumberFormat(void 0,{style:"currency",currency:"USD",maximumFractionDigits:2})}},[a==null?void 0:a.currency]),b=r.useMemo(()=>{const s=new Date;return s.setHours(0,0,0,0),s.toISOString()},[]);r.useEffect(()=>{let s=!0;const i=async()=>{y(!0),j(null);try{!(a!=null&&a.currency)&&(n!=null&&n.store_id)&&await d.from("stores").select("currency").eq("id",n.store_id).single();const{data:o,error:p}=await d.from("transactions").select("id, customer_name, total_amount, processed_at, status, transaction_items(count)").order("processed_at",{ascending:!1}).limit(5);if(p)throw p;const{data:v,error:k}=await d.from("transactions").select("id, total_amount, processed_at").gte("processed_at",b);if(k)throw k;const{count:I,error:w}=await d.from("products").select("id",{count:"exact",head:!0});if(w)throw w;const{data:M,error:S}=await d.from("products").select("id, name, sku, stock_quantity, min_stock_level, selling_price").limit(25);if(S)throw S;const _=(M||[]).filter(t=>(t.stock_quantity??0)<=(t.min_stock_level??0));if(!s)return;E((o||[]).map(t=>{var m;return{id:t.id,customer:t.customer_name||"â€”",amount:Number(t.total_amount||0),items:Array.isArray(t.transaction_items)&&t.transaction_items.length>0&&((m=t.transaction_items[0])==null?void 0:m.count)!=null?t.transaction_items[0].count:void 0,time:new Date(t.processed_at).toLocaleString(),status:t.status||"completed"}}));const $=(v||[]).reduce((t,m)=>t+Number(m.total_amount||0),0),q=(v||[]).length;L(_.slice(0,5).map(t=>({id:t.id,name:t.name,sku:t.sku,currentStock:t.stock_quantity??0,minStock:t.min_stock_level??0,price:Number(t.selling_price||0)}))),C({todaySales:$,transactionsToday:q,totalProducts:I||0,lowStockCount:_.length})}catch(o){console.error("Dashboard load error:",o),s&&j(o.message||"Failed to load dashboard")}finally{s&&y(!1)}};i();const f=V("transaction:completed",()=>i());return()=>{s=!1,f&&f()}},[b]);const F=r.useMemo(()=>[{title:"Today's Sales",value:N.format(l.todaySales),change:"",changeType:"neutral",icon:H,color:"bg-green-500"},{title:"Total Products",value:`${l.totalProducts}`,change:"",changeType:"neutral",icon:x,color:"bg-blue-500"},{title:"Transactions (Today)",value:`${l.transactionsToday}`,change:"",changeType:"neutral",icon:u,color:"bg-purple-500"},{title:"Low Stock Items",value:`${l.lowStockCount}`,change:"",changeType:"neutral",icon:h,color:"bg-orange-500"}],[l]);return A?e.jsx(U,{text:"Loading dashboard..."}):g?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 p-4 rounded",children:["Failed to load dashboard: ",g]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Dashboard"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-300",children:"Overview of your store performance"})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 flex space-x-3",children:[e.jsxs(c,{to:"/sales",className:"btn btn-primary btn-md",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"New Sale"]}),e.jsxs(c,{to:"/products",className:"btn btn-secondary btn-md",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Add Product"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:F.map((s,i)=>e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-3 rounded-lg ${s.color}`,children:e.jsx(s.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"ml-4 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:s.title}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s.value}),e.jsx("span",{className:`ml-2 text-sm font-medium ${s.changeType==="positive"?"text-green-600":"text-red-600"}`,children:s.change})]})]})]})},i))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Recent Transactions"}),e.jsxs(c,{to:"/reports",className:"text-sm text-primary-600 hover:text-primary-500 flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"View All"]})]})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"table-header",children:e.jsxs("tr",{children:[e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Items"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"table-cell text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:D.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.customer})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:N.format(s.amount)})}),e.jsx("td",{className:"table-cell",children:e.jsxs("div",{className:"text-gray-900 dark:text-gray-100",children:[s.items," items"]})}),e.jsx("td",{className:"table-cell",children:e.jsx("div",{className:"text-gray-500 dark:text-gray-300",children:s.time})}),e.jsx("td",{className:"table-cell",children:e.jsx("span",{className:"badge badge-success",children:s.status})})]},s.id))})]})})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Low Stock Alert"}),e.jsxs(c,{to:"/inventory",className:"text-sm text-primary-600 hover:text-primary-500 flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Manage"]})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-4",children:P.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200 dark:bg-red-900/20 dark:border-red-800",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["SKU: ",s.sku]}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsxs("span",{className:"text-sm text-red-600 dark:text-red-400 font-medium",children:[s.currentStock," in stock"]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 ml-2",children:["(min: ",s.minStock,")"]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx(h,{className:"w-5 h-5 text-red-500"})})]},s.id))})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Quick Actions"})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{to:"/sales",className:"w-full btn btn-primary btn-md justify-start",children:[e.jsx(u,{className:"w-4 h-4 mr-2"}),"Process Sale"]}),e.jsxs(c,{to:"/products",className:"w-full btn btn-secondary btn-md justify-start",children:[e.jsx(x,{className:"w-4 h-4 mr-2"}),"Add Product"]}),e.jsxs(c,{to:"/inventory",className:"w-full btn btn-secondary btn-md justify-start",children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Stock Management"]}),e.jsxs(c,{to:"/reports",className:"w-full btn btn-secondary btn-md justify-start",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"View Reports"]})]})})]})]})]})]})};export{J as default};
//# sourceMappingURL=Dashboard-C6_6lR-G.js.map
